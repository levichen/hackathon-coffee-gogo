(function () {
    "use strict";

    var querystring = require("querystring");
    var https = require("https");

    var HttpResponseProcessor = require("./HttpResponseProcessor.js");
    var validate = require("./validate.js");

    module.exports = function (apiKey, outputFormat) {
        return function (parameters, callback) {
            console.log(apiKey);
            validate.apiKey(apiKey);
            validate.outputFormat(outputFormat);
            parameters.key = apiKey;
            parameters.location = parameters.location || '25.0887379,121.5587818' ;
            parameters.types = parameters.types || 'restaurant';
            if (typeof parameters.location === "object") parameters.location = parameters.location.toString();
            parameters.radius = parameters.radius || 50000;
            parameters.sensor = parameters.sensor || false;
            var options = {
                hostname: "maps.googleapis.com",
                path: "/maps/api/place/radarsearch/" + outputFormat + "?" + querystring.stringify(parameters)
                /*path: "/maps/api/place/radarsearch/json?location=&radius=50000&types=museum&sensor=false&key=" + apiKey*/
            };
            console.log(options);
            var request = https.request(options, new HttpResponseProcessor(outputFormat === "json", callback));
            request.on("error", function (error) {
                callback(new Error(error));
            });
            request.end();
        };
    };

})();
